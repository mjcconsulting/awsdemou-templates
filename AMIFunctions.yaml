AWSTemplateFormatVersion: 2010-09-09
Description: AMIFunctions Template.
  This creates Lambda Functions related to AMIs, both public and private.
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: Stack Dependencies
        Parameters:
          - LayersStackName
          - BucketsStackName
          - TopicsStackName
    ParameterLabels:
      LayersStackName:
        default: Layers Stack Name
      BucketsStackName:
        default: Buckets Stack Name
      TopicsStackName:
        default: Topics Stack Name
Parameters:
  LayersStackName:
    Description: Name of the CloudFormation Stack containing Layers
    Type: String
    MinLength: 2
    MaxLength: 64
    Default: Layers
    AllowedPattern: ^[A-Z][-a-zA-Z0-9]*$
    ConstraintDescription: must begin with an upper case letter and contain alphanumeric characters and dashes.
  BucketsStackName:
    Description: Name of the CloudFormation Stack containing Buckets
    Type: String
    MinLength: 2
    MaxLength: 64
    Default: Buckets
    AllowedPattern: ^[A-Z][-a-zA-Z0-9]*$
    ConstraintDescription: must begin with an upper case letter and contain alphanumeric characters and dashes.
  TopicsStackName:
    Description: Name of the CloudFormation Stack containing Topics
    Type: String
    MinLength: 2
    MaxLength: 64
    Default: Topics
    AllowedPattern: ^[A-Z][-a-zA-Z0-9]*$
    ConstraintDescription: must begin with an upper case letter and contain alphanumeric characters and dashes.
Resources:
  Role:
    Type: AWS::IAM::Role
    Properties:
      Path: /
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - lambda.amazonaws.com
            Action:
              - sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: DescribeImagesPolicy
          PolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Action:
                  - ec2:DescribeImages
                Resource: '*'
  AmazonLinux2ImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: AmazonLinux2Image
      Description: A Lambda function that looks up the latest Amazon Linux 2 Image for a given OS Variant and Region (HVM64 only).
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'Amazon Linux 2'   : 'amzn2-ami-hvm-2.?.', // List default first
            'Amazon Linux 2.0' : 'amzn2-ami-hvm-2.0.'
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate + '*-x86_64-gp2';
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: ['amazon']
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.Name.localeCompare(x.Name))[0];
                    const responseData = {
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
  WindowsImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: WindowsImage
      Description: A Lambda function that looks up the latest Windows Image for a given OS Variant and Region, or a specific Windows Image if an additional OS Date is specified.
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'Windows Server 2019'    : 'Windows_Server-2019-English-Full-Base-', // List default first
            'Windows Server 2016'    : 'Windows_Server-2016-English-Full-Base-',
            'Windows Server 2012 R2' : 'Windows_Server-2012-R2_RTM-English-64Bit-Base-'
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate.substr(0,4) + '.' + osDate.substr(4,2) + '.' + osDate.substr(6,2);
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: ['amazon']
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.CreationDate.localeCompare(x.CreationDate))[0];
                    const responseData = {
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
  AmazonNATImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: AmazonNATImage
      Description: A Lambda function that looks up the latest Amazon NAT Image for a given Region (HVM64 only).
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'Amazon NAT'           : 'amzn-ami-vpc-nat-hvm-????.??.?.', // List default first
            'Amazon NAT 2018.03.0' : 'amzn-ami-vpc-nat-hvm-2018.03.0.',
            'Amazon NAT 2017.09.1' : 'amzn-ami-vpc-nat-hvm-2017.09.1.',
            'Amazon NAT 2017.09.0' : 'amzn-ami-vpc-nat-hvm-2017.09.0.',
            'Amazon NAT 2017.03.1' : 'amzn-ami-vpc-nat-hvm-2017.03.1.',
            'Amazon NAT 2017.03.0' : 'amzn-ami-vpc-nat-hvm-2017.03.0.'
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate + '-x86_64-ebs';
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: ['amazon']
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.Name.localeCompare(x.Name))[0];
                    const responseData ={
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
  BaselineAmazonLinux2ImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: BaselineAmazonLinux2Image
      Description: A Lambda function that looks up the Baseline Amazon Linux 2 Image for a given OS Variant and Region.
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'AWSDemoUniversity Baseline Amazon Linux 2'   : 'awsdemou-baseline-amzn2-ami-hvm-2.?.' // List default first
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const accountId = event.ResourceProperties.AccountId || context.invokedFunctionArn.split(':')[4];
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate + '*';
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: [accountId]
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.CreationDate.localeCompare(x.CreationDate))[0];
                    const responseData = {
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
  BaselineWindowsImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: BaselineWindowsImage
      Description: A Lambda function that looks up the Baseline Windows Image for a given OS Variant and Region.
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'AWSDemoUniversity Baseline Windows Server 2019'    : 'AWSDemoU-Baseline-Windows_Server-2019-English-Full-Base-', // List default first
            'AWSDemoUniversity Baseline Windows Server 2016'    : 'AWSDemoU-Baseline-Windows_Server-2016-English-Full-Base-',
            'AWSDemoUniversity Baseline Windows Server 2012 R2' : 'AWSDemoU-Baseline-Windows_Server-2012-R2_RTM-English-64Bit-Base-'
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const accountId = event.ResourceProperties.AccountId || context.invokedFunctionArn.split(':')[4];
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate.substr(0,4) + '.' + osDate.substr(4,2) + '.' + osDate.substr(6,2);
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: [accountId]
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.CreationDate.localeCompare(x.CreationDate))[0];
                    const responseData = {
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
  WordPressAmazonLinux2ImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: WordPressAmazonLinux2Image
      Description: A Lambda function that looks up the WordPress Amazon Linux 2 Image for a given OS Variant and Region.
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'AWSDemoUniversity WordPress Amazon Linux 2'   : 'awsdemou-wordpress-amzn2-ami-hvm-2.?.' // List default first
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const accountId = event.ResourceProperties.AccountId || context.invokedFunctionArn.split(':')[4];
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate + '*';
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: [accountId]
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.CreationDate.localeCompare(x.CreationDate))[0];
                    const responseData = {
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
  DatabaseManagementWindowsImageFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: DatabaseManagementWindowsImage
      Description: A Lambda function that looks up the Database Management Windows Image for a given OS Variant and Region.
      Role: !GetAtt Role.Arn
      Runtime: nodejs10.x
      Timeout: 30
      Layers:
        - !ImportValue
            Fn::Sub: ${LayersStackName}-AsyncCustomResourceLayerVersionArn
      Handler: index.handler
      Code:
        ZipFile: |
          const response = require('cfn-response-promise');

          const AWS = require('aws-sdk');
          AWS.config.apiVersions = {
            ec2: '2016-11-15'
          };

          const osNameToFilter = {
            'AWSDemoUniversity Database Management Windows Server 2019'    : 'AWSDemoU-DBManagement-Windows_Server-2019-English-Full-Base-', // List default first
            'AWSDemoUniversity Database Management Windows Server 2016'    : 'AWSDemoU-DBManagement-Windows_Server-2016-English-Full-Base-',
            'AWSDemoUniversity Database Management Windows Server 2012 R2' : 'AWSDemoU-DBManagement-Windows_Server-2012-R2_RTM-English-64Bit-Base-'
          };

          exports.handler = async (event, context) => {
            console.info(`Request body:\n${JSON.stringify(event)}`);

            switch (event.RequestType) {
              case 'Create':
              case 'Update':
                try {
                  const accountId = event.ResourceProperties.AccountId || context.invokedFunctionArn.split(':')[4];
                  const region = event.ResourceProperties.Region || process.env.AWS_REGION;
                  const osName = event.ResourceProperties.OSName || Object.keys(osNameToFilter)[0];
                  const osDate = event.ResourceProperties.OSDate || '????????';

                  let amiNameFilter = (! osNameToFilter[osName]) ? osNameToFilter[Object.keys(osNameToFilter)[0]] : osNameToFilter[osName];
                  amiNameFilter += osDate.substr(0,4) + '.' + osDate.substr(4,2) + '.' + osDate.substr(6,2);
                  console.info(`OS: ${osName}[${osDate}]`);
                  console.info(`Filter: ${amiNameFilter}`);

                  const ec2 = new AWS.EC2({region: region});

                  console.info(`Calling: DescribeImages...`);
                  const params = {
                    Filters: [{ Name: 'name', Values: [amiNameFilter]}],
                    Owners: [accountId]
                  };
                  const data = await ec2.describeImages(params).promise();

                  if (data.Images.length > 0) {
                    const image = data.Images.sort((x, y) => y.CreationDate.localeCompare(x.CreationDate))[0];
                    const responseData = {
                      Name: image.Name,
                      CreationDate: image.CreationDate
                    };
                    console.info(`Image: ${image.Name} (${image.ImageId})`);
                    await response.send(event, context, response.SUCCESS, responseData, image.ImageId);
                  }
                  else {
                    throw new Error(`Could not find Image(s) matching pattern ${amiNameFilter}`);
                  }
                }
                catch (err) {
                  const responseData = {Error: `${(err.code) ? err.code : 'Error'}: ${err.message}`};
                  console.error(responseData.Error);
                  await response.send(event, context, response.FAILED, responseData);
                }
                break;

              case 'Delete':
                await response.send(event, context, response.SUCCESS);
            }
          };
Outputs:
  AmazonLinux2ImageFunctionArn:
    Description: The AmazonLinux2Image Lambda Function ARN
    Value: !GetAtt AmazonLinux2ImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-AmazonLinux2ImageFunctionArn
  WindowsImageFunctionArn:
    Description: The WindowsImage Lambda Function ARN
    Value: !GetAtt WindowsImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-WindowsImageFunctionArn
  AmazonNATImageFunctionArn:
    Description: The AmazonNATImage Lambda Function ARN
    Value: !GetAtt AmazonNATImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-AmazonNATImageFunctionArn
  BaselineAmazonLinux2ImageFunctionArn:
    Description: The BaselineAmazonLinux2Image Lambda Function ARN
    Value: !GetAtt BaselineAmazonLinux2ImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-BaselineAmazonLinux2ImageFunctionArn
  BaselineWindowsImageFunctionArn:
    Description: The BaselineWindowsImage Lambda Function ARN
    Value: !GetAtt BaselineWindowsImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-BaselineWindowsImageFunctionArn
  WordPressAmazonLinux2ImageFunctionArn:
    Description: The WordPressAmazonLinux2Image Lambda Function ARN
    Value: !GetAtt WordPressAmazonLinux2ImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-WordPressAmazonLinux2ImageFunctionArn
  DatabaseManagementWindowsImageFunctionArn:
    Description: The DatabaseManagementWindowsImage Lambda Function ARN
    Value: !GetAtt DatabaseManagementWindowsImageFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-DatabaseManagementWindowsImageFunctionArn
